#lang rhombus/and_meta

// The "example-c.rhm" module exports `exint`
// as a variable, a binding form (matches any integer)
// and an annotation (matches any integer)

check:
  import: lib("rhombus/tests/example-c.rhm") as ex_c
  def ex_c.exint = 10
  10 :: ex_c.exint
  ex_c.exint
  ~is 10

check:
  ~eval
  begin:
    import: lib("rhombus/tests/example-c.rhm") as ex_c
    def ex_c.exint = 10
    10 :: ex_c.exint
    ex_c.exint
  ~is 10

check:
  import: lib("rhombus/tests/example-c.rhm") as ex_c
  def ex_c.exint = "10"
  ~raises "value does not satisfy annotation"

check:
  import: lib("rhombus/tests/example-c.rhm") as ex_c
  "10" :: ex_c.exint
  ~raises "value does not satisfy annotation"

check:
  import: lib("rhombus/tests/example-c.rhm") open
  def exint = 10
  10 :: exint
  exint
  ~is 10

check:
  import:
    lib("rhombus/tests/example-c.rhm"):
      open
      rename: exint as ex_int
  def ex_int = 10
  10 :: ex_int
  ex_int
  ~is 10

check:
  import:
    lib("rhombus/tests/example-c.rhm") as ex_c:
      rename: exint as ex_int
  def ex_c.ex_int = 10
  10 :: ex_c.ex_int
  ex_c.ex_int
  ~is 10

check:
  import:
    lib("rhombus/tests/example-c.rhm"):
      open
      only_space: ~default
  exint
  ~is 10

check:
  import:
    lib("rhombus/tests/example-c.rhm") as ex_c:
      only_space: ~default
  ex_c.exint
  ~is 10

check:
  ~eval
  begin:
    import:
      lib("rhombus/tests/example-c.rhm"):
        open
        only_space: ~default
    10 :: exint
  ~raises "not bound as an annotation"

check:
  ~eval
  begin:
    import:
      lib("rhombus/tests/example-c.rhm") as ex_c:
        only_space: ~default
    10 :: ex_c.exint
  ~raises "not bound as an annotation"

check:
  import:
    lib("rhombus/tests/example-c.rhm"):
      open
      only_space: rhombus/annot
  def exint = 11
  exint
  ~is 11

check:
  import:
    lib("rhombus/tests/example-c.rhm"):
      open
      only_space: rhombus/annot
  11 :: exint
  ~is 11

check:
  import:
    lib("rhombus/tests/example-c.rhm") as ex_c:
      only_space: rhombus/annot
  11 :: ex_c.exint
  ~is 11
